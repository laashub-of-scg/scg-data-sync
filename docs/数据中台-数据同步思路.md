# 数据中台-数据同步思路

拆解形成 任务队列、执行队列

相当于: 做什么、什么时候做

例如: 拆解一个人的行为为: 需要哪些事情的队列和有哪些时间能做事情

通过合理编排使得满足业务

## 执行队列

由于接口频率限制, 最大20次/H, 相当于最大执行频率为3分钟1一次, 可以设置调度频率为反复3分钟一次调度, 但是如果单接口中的分页有多页, 则会加倍接口调用次数限制的消耗, 这个需要注意, 如果不能调整接口调用频率限制则需要调整执行队列的频率为3*n, n为分页次数

执行队列不会关注调度的任务队列的任务是否在该时间段内完成, 例如: 如果该任务执行超过3min, 在第3min时仍然会再次执行该任务队列的任务

## 任务队列

分为历史任务、实时任务

如果本次实时执行失败了话, 对于下一次来说上次的实时任务其实就已经被历史任务已经包含了

优先级: 历史任务队列 > 实时任务队列

如果历史任务队列执行顺便则发送消息给管理员

### 历史队列

从设置的开始时间的那周的周一到周日的后一天作为第一周

依次类推后续的每一周

直到今天所在周的周一到周日的后一天作为最后一周

### 实时任务

最近三分钟

分析超时(超过3min)的工单推送企业微信消息给工单人

## 执行-任务

每一个任务都会有一个状态, 状态列表依次为: 创建-运行-异常-完成, 默认为空

例如:

```
task_name			is_history	status		exception_log	create_time	
20200801-20200806	1										202008171540
20200814-20200820	1			running     				202008171540
20200821-20200827	1			exception   				202008171540
20200828-20200903	1			finish      				202008171540


status的数据趋势: "" -> "running" -> "exception" -> "finish"
```

启动时会创建任务

调度到执行片段时设置状态为运行

如果该次调度任务出现异常, 则设置状态为异常



启动时动态加载执行队列

读取本地记录(sqlite3)中记录的任务状态

依次执行



